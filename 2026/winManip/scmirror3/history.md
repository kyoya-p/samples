# scmirror3 開発履歴

## 2026-01-23
- **worker.ps1 のコンパクト化と安定化**
  - Win32 API 呼び出しの整理と型定義の最小化。
  - PowerShell 5.1 互換のため三項演算子を `if/else` に修正。
  - 座標計算用の `Make-LParam` 追加とビット演算の厳密化。
  - `GetForegroundWindow` を使用したアクティブウィンドウへのキー転送機能追加。
- **全画面共有モードの実装**
  - `index.html` で `displaySurface: "monitor"` を優先し、全画面での座標変換（絶対ピクセル座標ベース）に対応。
  - ウィンドウ選択ドロップダウンを廃止し、クリック位置からターゲットウィンドウを自動特定する方式へ移行。
- **UI/UX の改善**
  - 操作画面の `document.title` に現在の絶対ピクセル座標をリアルタイム表示。
  - `infoOverlay` の表示を `Pos/Size` の固定情報に整理。
  - サーバールート `http://localhost:3003/` で `index.html` を直接配信するように変更。
- **ev-tester.html の大幅刷新**
  - 3x9 のグリッド構成に変更し、計27個の `TextField` を配置。
  - 各フィールドに 'A'~'Z' の初期値を設定し、精度テストを容易化。
  - マウスクリック跡（ドット）を最新の1つのみ表示するように改善。
  - フォーカス状態の視覚化（ステータス表示と枠線強調）。
- **通信の最適化**
  - `move` イベント時の解像度情報出力を廃止し、`click` 時のみに限定して通信量を削減。

## 2026-01-24
- **絶対座標表示の修正**
  - ターゲットウィンドウ指定モード時に、サーバーから送信される `left/top` オフセットを加算して正しい絶対ピクセル座標を表示するように `index.html` を修正。
- **キー入力の安定化と互換性向上**
  - `server.js` において、単一文字および特殊キーの送信時に `WM_KEYDOWN`, `WM_CHAR`, `WM_KEYUP` をセットで送信するように強化。
  - 矢印キー、Tab、Delete、Escape などの特殊キーの転送に対応。
- **ターゲット追従ロジックの改善**
  - サーバー側で最後にクリックされたウィンドウのハンドル (`lastHwnd`) を記憶し、フルスクリーンモードでのキー入力ターゲットを固定化。これによりブラウザがフォアグラウンドになっても操作対象へのキー送信が可能に。
  - PowerShell側からウィンドウハンドル `h` を返し、サーバー側で管理する連携フローを構築。
