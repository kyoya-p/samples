<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Event Precision Tester</title>
    <style>
        body {
            margin: 0; padding: 0; background: #1a1a1a; color: #0f0;
            font-family: 'Courier New', monospace; overflow: hidden;
            display: flex; flex-direction: column; height: 100vh;
        }
        #status-bar {
            height: 40px; background: #222; border-bottom: 2px solid #0f0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; font-size: 14px; color: #ff0; z-index: 100;
        }
        #grid-container {
            flex-grow: 1; display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 5px; padding: 5px; box-sizing: border-box;
            position: relative;
        }
        input {
            background: #2a2a2a; color: #0f0; border: 1px solid #444;
            font-size: 18px; text-align: center; border-radius: 4px;
            transition: all 0.2s; cursor: crosshair;
            width: 80px; height: 30px; justify-self: center; align-self: center;
        }
        input:focus {
            background: #333; border-color: #ff0; color: #fff;
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.3); outline: none;
        }
        #click-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 50;
        }
        .log-overlay {
            position: fixed; bottom: 10px; left: 10px; width: 300px; max-height: 150px;
            background: rgba(0,0,0,0.7); font-size: 10px; overflow-y: auto;
            pointer-events: none; border: 1px solid #444; padding: 5px;
        }
    </style>
</head>
<body>
    <div id="status-bar">
        <div id="kbStatus">Ready. Click any field.</div>
        <div id="live-coord">X: 0, Y: 0</div>
        <button onclick="clearLogs()" style="background:#0f0; border:none; cursor:pointer; font-weight:bold; padding:2px 10px;">Clear</button>
    </div>
    <div id="grid-container">
        <canvas id="click-canvas"></canvas>
    </div>
    <div class="log-overlay" id="logList"></div>

    <script>
        const grid = document.getElementById('grid-container');
        const canvas = document.getElementById('click-canvas');
        const ctx = canvas.getContext('2d');
        const kbStatus = document.getElementById('kbStatus');
        const liveCoord = document.getElementById('live-coord');
        const logList = document.getElementById('logList');

        let markers = [];

        function resize() {
            canvas.width = grid.clientWidth;
            canvas.height = grid.clientHeight;
        }
        window.addEventListener('resize', resize);
        setTimeout(resize, 100);

        function addLog(msg) {
            const entry = document.createElement('div');
            entry.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logList.insertBefore(entry, logList.firstChild);
        }

        // Generate 3x9 Inputs
        for (let i = 0; i < 27; i++) {
            const input = document.createElement('input');
            input.type = 'text';
            input.id = `input-${i}`;
            const char = i < 26 ? String.fromCharCode(65 + i) : "";
            input.value = char;
            input.placeholder = `(${Math.floor(i/3)},${i%3})`;
            
            input.addEventListener('focus', () => {
                kbStatus.innerText = `Focused: ID=${input.id} Val="${input.value}"`;
                addLog(`Focus: ${input.id}`);
            });

            input.addEventListener('keydown', (e) => {
                kbStatus.innerText = `Key: ${e.key} in ${input.id}`;
                addLog(`${input.id} Key: ${e.key}`);
            });

            input.addEventListener('input', (e) => {
                addLog(`${input.id} NewVal: ${e.target.value}`);
            });

            grid.appendChild(input);
        }

        window.addEventListener('mousemove', (e) => {
            liveCoord.innerText = `X: ${e.clientX}, Y: ${e.clientY}`;
        });

        window.addEventListener('mousedown', (e) => {
            markers = [{x: e.clientX, y: e.clientY - 40}]; // Clear previous and keep only last
            addLog(`Click: ${e.clientX}, ${e.clientY}`);
        });

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            markers.forEach(m => {
                ctx.beginPath(); ctx.arc(m.x, m.y, 10, 0, Math.PI*2);
                ctx.strokeStyle = '#f0f'; ctx.lineWidth = 2; ctx.stroke();
                ctx.beginPath(); ctx.moveTo(m.x-15, m.y); ctx.lineTo(m.x+15, m.y);
                ctx.moveTo(m.x, m.y-15); ctx.lineTo(m.x, m.y+15); ctx.stroke();
            });
            requestAnimationFrame(render);
        }
        render();

        function clearLogs() {
            logList.innerHTML = '';
            markers = [];
        }
    </script>
</body>
</html>