# ソフトウェア設計

## 5.1. データベース設計 (Firestore)
- **コレクション**: `addressbook`
- **ドキュメント構造**:
    ```json
    {
      "name": "String (Document IDとしても使用)",
      "email": "String",
      "timestamp": "ServerTimestamp"
    }
    ```
## 5.2. データ転送
- **アドレス取得データ単位**
  - ターミナル画面サイズから算出 (`nAddress`)
  - 初回取得時は、画面を確実に埋めて不要な追加読み込みを防ぐため、「画面の高さ + 予備バッファ(5行)」を1ページとして取得する。
- **効率化のポイント**
  - 一度の取得数が少なすぎると、初期表示だけで複数回の通信が発生し非効率。
  - 一度の取得数が多すぎると、表示されない無駄なデータを取得することになる。
  - 上記の計算により、初期表示に必要な最小限かつ十分なデータを1回のクエリで取得する。
- **ページング制御 (無限スクロール)**
  -以下のような表示範囲が変化した場合、次のアドレスをクエリ取得する。
    - ユーザーがスクロール
    - ターミナルサイズ変更
  - ページングには Firestore のカーソル機能 (`startAfter`) を使用し、直前のページの最後のデータ以降を取得する。

## ログ・デバッグ
- **ファイル出力**: `app.log` 形式のファイルに実行ログを記録。
- **例外処理**: 致命的なエラー発生時はスタックトレースをログに記録し、安全に終了またはエラーを通知する。
