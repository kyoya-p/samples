# 仕様書: Firebase C++ SDK TUI Sample

# 1. 概要
本アプリケーションは、**Firebase C++ SDK** と **FTXUI** を使用し、Linuxターミナル上で動作するアドレス帳アプリケーションである。Google Cloud Firestore とリアルタイムに通信し、データの閲覧、追加、削除を行うことができる。

# 2. システム要件
- **OS**: Ubuntu 24.04(x86_64)
- **依存ライブラリ**:
    - Firebase C++ SDK (v13.3.0)
    - FTXUI (v5.0.0)
    - libcurl, openssl, zlib, libsecret-1, pthread

# 3. 機能要件

## 3.1 起動と接続
- **API Key 管理**:
    - 環境変数 `FB_API_KEY` または `API_KEY` から初期値を読み込む。
    - もしくは、 アプリ設定ファイル(./app.conf) に記載されたAPI_KEY を採取し使用
    - 未設定または接続エラー時は、メイン画面下部の `[Activate]` ボタンから設定画面を開き、手動で入力・再接続が可能。
- **[Activate] 設定ダイアログ**:
    - メイン画面の上にオーバーレイ（モーダル）として表示される。
    - **API Key 入力欄**: 現在のキーが表示され、編集可能。
    - **[Connect] ボタン**: 入力されたキーをFirebaseに反映し保存(設定ファイルに保存)、設定画面を閉じ、メイン画面へ戻る。
    - **[Cancel] ボタン**: 変更を破棄してメイン画面へ戻る。
    - **エラーフィードバック**: キーが無効な場合やネットワークエラーが発生した場合、ダイアログ内に具体的なエラー理由を表示する。
- **ステータス表示**:
    - 接続状況（Connected / Disconnected）をヘッダーに表示。
    - エラー発生時はエラーメッセージを赤字で表示。

## 3.4 終了処理
- **[Close] ボタン**:
    - アプリケーションを安全に終了させる。
- **[q] キー**: `[Close]` ボタンと同様にアプリケーションを終了するショートカット。

## 3.2 アドレス帳リスト表示
- **データソース**: Firestore `addressbook` コレクション。
- **表示項目**:
    1. **Name**: 連絡先名（固定幅 28文字）
    2. **Mail Address**: メールアドレス（可変幅）
    3. **Created At**: 作成日時 `MM/DD HH:MM` 形式（固定幅 16文字）
    4. **Operation**: 操作ボタン（固定幅 10文字）
- **ソート順**: `timestamp` フィールドの昇順（古い順）。
- **無限スクロール (Infinite Scroll)**:
    - 初期表示は画面サイズに応じた件数。
    - リスト最下部へのスクロールを検知し、自動的に次の10件を取得・追加表示する。
    - データ取得中は `Loading...`、全データ表示後は `last of data` を表示。

## 3.3 データ操作
- **新規追加**:
    - フッター上部の入力エリアを使用。
    - **Name** および **Email** 欄にはランダムな初期値が自動入力される。
    - ユーザーは値を編集可能。
    - `[Add]` ボタン押下で Firestore にドキュメントを作成（IDはNameを使用）。
    - 追加成功後、入力欄には新たなランダム値がセットされる。
- **削除**:
    - リスト各行の `[Remove]` ボタン押下で、該当ドキュメントを即時削除。

# 4. UI/UX デザイン

- **ターミナルアプリ:**
- **レイアウト**:
    - **Header**: ステータス、カラムヘッダー。
    - **Body**: スクロール可能なリスト領域。偶数行/奇数行の背景色変更（ストライプ）による視認性向上。
    - **Footer**: 入力フォーム、操作ボタン（`[Activate]`, `[Close]`）。
- **スタイル**:
    - テーブル形式（垂直罫線あり）。
    - フォーカスのある要素（ボタン等）はハイライト。
    - 終了ボタン (`[Close]`) または `q` キーでアプリケーションを終了。
- **操作方法**:
    - **マウス操作**:
        - **クリック**: 各種ボタン（`[Add]`, `[Remove]`, `[Activate]` 等）の実行、入力フィールドのフォーカス選択。
        - **ホイール**: アドレス帳リストの上下スクロール。リスト終端に達すると追加ロードがトリガーされる。
    - **キーボード操作**:
        - **Tab / Shift+Tab**: 入力フィールドやボタン間のフォーカス移動。
        - **矢印キー (↑/↓)**: リストのスクロール、または垂直配置された要素間の移動。
        - **Enter**: フォーカスされたボタンの実行。
        - **文字入力**: フォーカスされた `Name` / `Email` フィールドへのテキスト入力。
        - **q**: アプリケーションの終了（ショートカット）。
