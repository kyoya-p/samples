# 棄却・失敗した検討の履歴

本プロジェクトの開発過程において、一度は検討・実装されたものの、技術的制約や設計方針により最終的に採用されなかった手法や失敗したアプローチを記録する。

## 技術的試行と棄却

### 1. 標準的な Win32 メッセージによる外部操作
- **不採用案**: `PostMessage` や `SendMessage` を使用した、対象ウィンドウへのキーイベント送信。
- **失敗の理由**: FTXUI 等の TUI アプリケーションは、標準的な Windows メッセージループではなくコンソール入力バッファを直接参照しているため、これらのメッセージを無視する。
- **代替策**: 親プロセスである Windows Terminal (`WindowsTerminal.exe`) に対する `SendKeys` または PTY 経由の入力。

### 2. GDI ベースのウィンドウ単位キャプチャ
- **不採用案**: `PrintWindow` や `BitBlt` (GDI) を用いた、特定ウィンドウハンドル (`HWND`) のみの画像取得。
- **失敗の理由**: Windows Terminal が GPU レンダリング (AtlasEngine) を採用しているため、GDI キャプチャではクライアント領域が「真っ黒」になる。
- **代替策**: 対象ウィンドウを前面に固定 (`SetForegroundWindow`) した上でのデスクトップ全体キャプチャ (`CopyFromScreen`) と切り抜き。

### 3. FTXUI コンポーネントでの参照キャプチャ (`[&]`)
- **不採用案**: ラムダ式内でのローカル変数への参照キャプチャ。
- **失敗の理由**: コンポーネントのレンダリングが非同期、または親コンポーネントの寿命を超えて実行される場合があり、アクセス違反 (Access Violation) を誘発した。
- **対策**: 常に値キャプチャ (`[=]`) または `shared_ptr` による寿命管理を徹底。

### 4. 独自バッファによるデータ保持
- **不採用案**: `std::vector<Contact>` 等のローカル配列に Firestore の全データをキャッシュする構成。
- **失敗の理由**: 通信コストとメモリ使用量の増大。特に大量のデータがある場合にページング制御が複雑化し、Firestore のリアルタイム更新との整合性確保が困難になった。
- **代替策**: `QuerySnapshot` からの直接抽出による完全バッファレス・レンダリング。

### 5. カラム単位の反転・フォーカス表示
- **不採用案**: `Name`, `Time`, `Operation` 各カラムにマウスホバーやフォーカス時の反転表示（ハイライト）を付与。
- **失敗の理由**: TUI の画面構成において視覚的なノイズが大きく、本来フォーカスすべき「行全体」や「操作ボタン」の視認性を損なった。
- **結論**: シンプルな行単位のインジケータ (`>`) のみに集約。

### 6. pwsh.exe のウィンドウハンドル特定
- **不採用案**: アプリを実行している PowerShell (`pwsh.exe`) のプロセス ID からウィンドウを特定。
- **失敗の理由**: Windows Terminal 内で動作している場合、シェルプロセス自身は独立したウィンドウを持たない。
- **結論**: 親プロセスである `WindowsTerminal.exe` を特定対象とした。
