# 仕様書: QuantumRoast Scanner

# 1. 概要
本アプリケーションは、**Firebase C++ SDK** と **FTXUI** を使用し、LinuxターミナルおよびWindowsで動作する多機能スキャナーアプリケーションである。
Google Cloud Firestore とリアルタイムに通信し、アドレス帳の管理やスキャン送信シミュレーションを行うことができる。

# 2. システム要件
- **OS**: Ubuntu 24.04 (x86_64) / Windows 10/11 (x64)
- **依存ライブラリ**:
    - Firebase C++ SDK (v13.3.0)
    - FTXUI (v5.0.0)
    - libcurl, openssl, zlib, libsecret-1, pthread (Linux)
    - Windows System Libraries (Windows)

# 3. 機能要件

## 3.1 共通機能
- **API Key 管理**:
    - 起動時に以下の優先順位で API Key を読み込む。
        1. 環境変数 `FB_API_KEY`
        2. 環境変数 `API_KEY`
        3. 設定ファイル `app.conf` (キー名: `API_KEY`)
    - 接続確立成功時、有効な API Key を `app.conf` に保存する。

## 3.2 メインメニュー (Main Screen)
アプリケーション起動直後に表示されるハブ画面。
- **機能選択**:
    - **Scan & Send**: スキャン送信画面へ遷移。
    - **Address Book Edit**: アドレス帳編集画面へ遷移。
- **フッター情報**:
    - **Status**: 現在のFirebase接続状況 (Connected / Disconnected) を表示。
    - **[Exit]**: アプリケーションを終了する。

## 3.3 スキャン送信 (Scan & Send)
宛先リストを作成し、送信アクション（シミュレーション）を行う画面。
- **宛先リスト (To:)**:
    - 複数の宛先（メールアドレス）をリスト管理。
    - **直接入力**: `Address` 欄に直接タイプ可能。
    - **[Select]**: アドレス帳ピッカー（後述）を開き、登録済み連絡先から選択・入力。
    - **[Remove]**: その行をリストから削除。
    - **(+) ボタン**: 新規宛先行を追加。
- **送信アクション**:
    - **[Send]**: 設定された全宛先に対して送信処理（ログ出力）を行い、リストをクリアする。
    - **[Back]**: メインメニューへ戻る。
- **アドレス帳ピッカー**:
    - `[Select]` ボタンでオーバーレイ表示される簡易アドレス帳リスト。
    - 連絡先を選択すると、そのメールアドレスが宛先欄に入力される。

## 3.4 アドレス帳選択ダイアログ
- **リスト表示**:
  - **Name** , **Mail Address** (可変), **Time** (16文字)のカラム構成。
  - **無限スクロール**: スクロールに応じて自動的に追加データを取得 (Infinite Scroll)。
  - カラムタイトルクリックでカラムが選択される。ほかのカラムは非選択となる。
  - 選択されたカラムはソート可能。カラム名をクリックするとソート順が反転する
  - ソート: 初期表示時、作成日時 (`timestamp`) で降順ソート
  - "Name", "Address"は、選択時、検索文字列入力フィールドがひょうじされる。入力文字列で検索され表示
## 3.4 アドレス帳編集 (Address Book Edit)
Firestore上の `addressbook` コレクションを管理する画面。
- **リスト表示**:
    - **Name** (28文字), **Mail Address** (可変), **Time** (16文字), **Operation** (10文字) のカラム構成。
    - **無限スクロール**: スクロールに応じて自動的に追加データを取得 (Infinite Scroll)。
    - **ソート**: 作成日時 (`timestamp`) 昇順。
- **新規追加**:
    - フッター上部の入力エリアで `Name`, `Email` を指定して `[Add]`。
    - 入力欄にはランダムな初期値が自動設定される（編集可能）。
      - 先頭につける文字は、'a.'~'Z,'または、'aa.'~'ZZ.'の範囲で、または付与しない、のいずれか
- **削除**:
    - リスト各行の `[Remove]` ボタンで即時削除。
- **フッター操作**:
    - **Status**: 接続状況および詳細なエラーメッセージを表示。
    - **[Close]**: メインメニューへ戻る。

# 4. UI/UX デザイン

## 4.1 全体レイアウト
- **TUIフレームワーク**: FTXUIを使用し、マウス・キーボード両対応のインターフェースを提供。
- **テーマ**:
    - 境界線 (`border`) で区切られた明確なエリア。
    - フォーカス要素は `inverted` (反転色) でハイライト。
    - アドレス帳リストはストライプ配色は視認性を確保。

## 4.2 キーボード操作
- **Tab / Shift+Tab**: フォーカス移動。
- **矢印キー (↑/↓)**: リストスクロール、垂直要素移動。
- **Enter**: ボタン実行、選択。
- **文字入力**: 各種入力フィールドへのテキスト入力。
- **q**: アプリケーション終了（メインメニュー時）または戻る（サブ画面時）。